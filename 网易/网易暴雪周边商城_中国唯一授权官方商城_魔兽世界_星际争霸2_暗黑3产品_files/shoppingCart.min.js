var SHOPPING_CART=function(){var COOKIE_CART="cart_info";_load=function(){var cart=$.evalJSON($.cookie(COOKIE_CART));return cart==null?{"products":{},"comb":[],"rdp":[],"gb":[],"doa":{}}:cart;};this.load=_load;_save=function(d){$.cookie(COOKIE_CART,$.toJSON(d),{path:"/",expires:30});};this.save=_save;this.add_product=function(sub_pid,num){var cart=_load();var cur_num=cart.products[sub_pid];cart.products[sub_pid]=(cart.products[sub_pid]||0)+num;_save(cart);}
this.add_comb=function(act_id,sub_pids){var cart=_load(),exist=false;sub_pids.sort();$.each(cart.comb,function(i,d){if(d["act_id"]==act_id&&d["sub_pids"].toString()==sub_pids.toString()){exist=true;d["num"]++;return false;}});if(!exist){cart.comb.push({"act_id":act_id,"sub_pids":sub_pids,"num":1});}
_save(cart);}
this.add_rdp=function(act_id,sub_pid,num){var cart=_load(),exist=false;$.each(cart.rdp,function(i,d){if(d["act_id"]==act_id&&d["sub_pid"]==sub_pid){exist=true;d["num"]+=num;return false;}});if(!exist){cart.rdp.push({"act_id":act_id,"sub_pid":sub_pid,"num":num})}
_save(cart);}
this.add_gb=function(act_id,sub_pid,num){var cart=_load(),exist=false;$.each(cart.gb,function(i,d){if(d["act_id"]==act_id&&d["sub_pid"]==sub_pid){exist=true;d["num"]+=num;return false;}});if(!exist){cart.gb.push({"act_id":act_id,"sub_pid":sub_pid,"num":num})}
_save(cart);}
this.add_doa=function(act_id,sub_pid,num){add_product(sub_pid,num);var cart=_load();cart.doa[act_id]=cart.doa[act_id]||[];var exist=false;$.each(cart.doa[act_id],function(i,doa_sub_pid){if(sub_pid==doa_sub_pid){exist=true;}});if(!exist){cart.doa[act_id].push(sub_pid);}
_save(cart);}
this.get_products_num=function(want_sub_pid){var n=0;var cart=_load();$.each(cart.products,function(sub_pid,num){if(!want_sub_pid||want_sub_pid==sub_pid){n+=parseInt(num);}});$.each(cart.comb,function(i,d){if(!want_sub_pid){n+=d.sub_pids.length*d.num;}else{$.each(d.sub_pids,function(i,sub_pid){if(want_sub_pid==sub_pid){n+=d.num;}});}});$.each(cart.rdp,function(i,d){if(!want_sub_pid||want_sub_pid==d.sub_pid){n+=d.num;}});$.each(cart.gb,function(i,d){if(!want_sub_pid||want_sub_pid==d.sub_pid){n+=d.num;}});return n;};this.get_rdp_products_num=function(want_sub_pid){var n=0;var cart=_load();$.each(cart.rdp,function(i,d){if(!want_sub_pid||want_sub_pid==d.sub_pid){n+=d.num;}});return n;}
this.get_gb_products_num=function(){var n=0;var cart=_load();$.each(cart.gb,function(i,d){n+=d.num;});return n;}
this.get_sub_p=function(){var cart=_load(),sub_p={};$.each(cart.products,function(sub_pid,num){sub_p[sub_pid]=num;});$.each(cart.comb,function(i,d){$.each(d.sub_pids,function(i,comb_sub_pid){sub_p[comb_sub_pid]=(sub_p[comb_sub_pid]||0)+d.num;});});$.each(cart.rdp,function(i,d){sub_p[d.sub_pid]=(sub_p[d.sub_pid]||0)+d.num;});$.each(cart.gb,function(i,d){sub_p[d.sub_pid]=(sub_p[d.sub_pid]||0)+d.num;});return sub_p;};this.clear=function(){_save(null);};return this;};